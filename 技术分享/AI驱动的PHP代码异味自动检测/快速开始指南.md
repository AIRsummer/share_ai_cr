# AI驱动的PHP代码异味检测 - 快速开始指南

## 🚀 3分钟快速体验

### 方案一：GitHub CodeRabbit（推荐新手）

**适用场景**：GitHub项目，希望零配置快速体验

```bash
# 1. 访问 https://coderabbit.ai
# 2. 使用GitHub账号登录  
# 3. 选择要分析的仓库
# 4. 创建开发分支提交代码，创建一个PR，CodeRabbit会自动分析并评论
```

**优势**：
- ✅ 完全免费（开源项目）
- ✅ 零配置，立即可用
- ✅ 支持多种语言包括PHP
- ✅ 智能PR摘要和代码建议

### 方案二：本地PHPMND + 简单AI（适合现有项目）

**安装**：
```bash
# 安装传统工具
composer require --dev povils/phpmnd

# 安装Python AI依赖
pip install scikit-learn pandas numpy

# 运行魔数检测
./vendor/bin/phpmnd src/ --extensions=default_parameter,return,argument
```

**快速AI增强**：
```python
# simple_ai_checker.py
import subprocess
import json
import re

def analyze_with_ai(file_path):
    """简单的AI增强分析"""
    
    # 1. 运行传统工具
    result = subprocess.run(['./vendor/bin/phpmnd', file_path], 
                          capture_output=True, text=True)
    
    # 2. 读取文件内容
    with open(file_path, 'r') as f:
        content = f.read()
    
    # 3. 简单的AI规则检测
    issues = []
    
    # 检测长方法
    methods = re.findall(r'function\s+\w+.*?\{(.*?)\}', content, re.DOTALL)
    for i, method_body in enumerate(methods):
        lines = method_body.count('\n')
        if lines > 20:
            issues.append(f"方法 #{i+1} 可能过长 ({lines} 行)")
    
    # 检测重复代码模式
    vip_discounts = re.findall(r'VIP.*?(\d+\.?\d*)', content)
    if len(set(vip_discounts)) > 1:
        issues.append(f"VIP折扣不一致: {vip_discounts}")
    
    return {
        'traditional_issues': result.stdout,
        'ai_enhanced_issues': issues
    }

# 使用示例
if __name__ == '__main__':
    result = analyze_with_ai('src/YourClass.php')
    print("=== 传统工具检测 ===")
    print(result['traditional_issues'])
    print("\n=== AI增强检测 ===")
    for issue in result['ai_enhanced_issues']:
        print(f"⚠️  {issue}")
```

### 方案三：开源PR-Agent（适合团队协作）

**GitHub集成**：
```bash
# 1. Fork https://github.com/Codium-ai/pr-agent
# 2. 配置GitHub Token
export GITHUB_TOKEN="your_token_here"

# 3. 创建配置文件
cat > .pr_agent.toml << EOF
[github]
user_token = "$GITHUB_TOKEN"

[pr_reviewer]
require_tests_review = true
require_security_review = true
auto_review = true

[pr_description]
use_bullet_points = true
include_generated_by_footer = false
EOF

# 4. 运行分析
python -m pr_agent.cli --pr_url="https://github.com/your-org/your-repo/pull/123"
```

## 📊 选择建议

| 场景 | 推荐方案 | 优势 | 时间投入 |
|------|----------|------|----------|
| **GitHub开源项目** | CodeRabbit | 免费+智能 | 5分钟 |
| **企业私有项目** | PR-Agent | 开源+可控 | 30分钟 |
| **现有CI/CD** | PHPMND + 自定义 | 灵活+渐进 | 2小时 |
| **深度定制** | 自建系统 | 完全控制 | 1-2周 |

## 🎯 立即行动

### 今天就可以做的事：

1. **5分钟体验**：
   - 在GitHub项目中安装CodeRabbit
   - 创建一个包含问题代码的PR
   - 观察AI的分析结果

2. **30分钟试点**：
   - 在一个小项目中安装PHPMND
   - 运行检测并查看结果
   - 使用上面的simple_ai_checker.py增强

3. **1小时深入**：
   - 克隆PR-Agent项目
   - 配置自己的GitHub仓库
   - 体验完整的AI代码审查流程

### 下周可以考虑的事：

1. **团队讨论**：
   - 分享体验结果
   - 讨论哪种方案适合团队
   - 制定试点计划

2. **CI/CD集成**：
   - 选择一个工具集成到现有流程
   - 设置合适的阈值和规则
   - 训练团队使用

3. **效果评估**：
   - 收集1-2周的使用数据
   - 分析误报率和有用性
   - 决定是否大规模推广

## 🔧 故障排除

### 常见问题

**Q: CodeRabbit为什么没有分析我的PR？**
- 检查是否正确安装了GitHub App
- 确认PR包含PHP代码变更
- 查看仓库设置中的CodeRabbit配置

**Q: PHPMND报告太多误报怎么办？**
```bash
# 使用更严格的过滤
./vendor/bin/phpmnd src/ --ignore-numbers=0,1,2,100 --ignore-funcs=intval,count
```

**Q: AI工具速度太慢？**
- 只分析变更的文件，不要全量扫描
- 使用增量分析模式
- 考虑将大文件拆分为小文件

**Q: 如何自定义检测规则？**
```python
# 在simple_ai_checker.py中添加自定义规则
def custom_business_rules(content):
    """自定义业务规则检测"""
    issues = []
    
    # 检测特定的业务模式
    if 'calculatePrice' in content and 'discount' not in content:
        issues.append("价格计算方法应该考虑折扣逻辑")
    
    return issues
```

## 📚 进阶学习

### 深入理解AI代码检测

1. **核心概念**：
   - 抽象语法树(AST)分析
   - 机器学习特征工程  
   - 业务逻辑模式识别

2. **推荐资源**：
   - 论文：《AI in Software Engineering: A Systematic Review》
   - 工具：nikic/php-parser文档
   - 案例：大厂的AI代码审查实践

3. **社区参与**：
   - GitHub关注相关开源项目
   - 参加CodeReview相关的技术讨论
   - 贡献自己的检测规则和改进

---

**🎉 开始你的AI代码检测之旅吧！**

记住：**最好的工具是你会使用的工具**。从简单开始，逐步优化，最终找到适合你团队的完美方案。 