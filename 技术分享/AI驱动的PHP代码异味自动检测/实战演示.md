# AIé©±åŠ¨çš„PHPä»£ç å¼‚å‘³æ£€æµ‹ - å®æˆ˜æ¼”ç¤º

## ğŸ¯ æ¼”ç¤ºå¤§çº²

### 1. ç¯å¢ƒå‡†å¤‡ (5åˆ†é’Ÿ)
### 2. ä¼ ç»Ÿå·¥å…· vs AIå·¥å…·å¯¹æ¯” (10åˆ†é’Ÿ)  
### 3. å¼€æºAIå·¥å…·å®æˆ˜ (15åˆ†é’Ÿ)
### 4. è‡ªå»ºAIæ£€æµ‹ç³»ç»Ÿæ¼”ç¤º (15åˆ†é’Ÿ)
### 5. CI/CDé›†æˆæ¼”ç¤º (10åˆ†é’Ÿ)
### 6. æ•ˆæœå¯¹æ¯”ä¸è®¨è®º (5åˆ†é’Ÿ)

---

## 1. ç¯å¢ƒå‡†å¤‡

### 1.1 åŸºç¡€ç¯å¢ƒè®¾ç½®

```bash
# åˆ›å»ºæ¼”ç¤ºé¡¹ç›®
mkdir ai-php-smell-demo && cd ai-php-smell-demo

# åˆå§‹åŒ–Composeré¡¹ç›®
composer init --name="demo/php-smell-detection" --no-interaction

# å®‰è£…å¿…è¦çš„PHPä¾èµ–
composer require nikic/php-parser symfony/finder symfony/console

# å®‰è£…å¼€å‘å·¥å…·
composer require --dev phpstan/phpstan psalm/psalm povils/phpmnd

# Pythonç¯å¢ƒè®¾ç½®
python3 -m venv venv
source venv/bin/activate
pip install scikit-learn pandas numpy matplotlib seaborn

# åˆ›å»ºé¡¹ç›®ç»“æ„
mkdir -p {src,tests,demo_code,reports,tools}
```

### 1.2 æ¼”ç¤ºä»£ç å‡†å¤‡

```php
<?php
// demo_code/BadCode.php - æ•…æ„å†™çš„æœ‰é—®é¢˜çš„ä»£ç 
class OrderProcessor
{
    public function processOrder($orderId, $userId, $items, $discount, $shippingAddress, $billingAddress, $paymentMethod, $specialInstructions) 
    {
        // é•¿å‚æ•°åˆ—è¡¨å¼‚å‘³
        
        if ($orderId < 1) {
            throw new Exception("Invalid order");
        }
        
        $total = 0;
        foreach ($items as $item) {
            if ($item['price'] > 0) {
                if ($item['quantity'] > 0) {
                    if ($item['category'] == 'electronics') {
                        if ($item['warranty'] == true) {
                            $total += $item['price'] * $item['quantity'] * 1.1; // æ·±å±‚åµŒå¥—
                        } else {
                            $total += $item['price'] * $item['quantity'];
                        }
                    } else {
                        $total += $item['price'] * $item['quantity'];
                    }
                }
            }
        }
        
        // é‡å¤çš„æŠ˜æ‰£è®¡ç®—é€»è¾‘ï¼ˆä¸šåŠ¡ä¸ä¸€è‡´ï¼‰
        if ($userId == 'VIP') {
            $total = $total * 0.8; // 20%æŠ˜æ‰£
        }
        
        // ç¡¬ç¼–ç çš„é…ç½®æ•°æ®
        $shippingCost = 15.99;
        $taxRate = 0.085;
        
        $finalTotal = $total + $shippingCost + ($total * $taxRate);
        
        // SQLæ³¨å…¥é£é™©
        $sql = "INSERT INTO orders (user_id, total) VALUES (" . $userId . ", " . $finalTotal . ")";
        
        // æ‰§è¡Œè®¢å•å¤„ç†...
        $this->processPayment($paymentMethod, $finalTotal);
        $this->sendNotification($userId);
        $this->updateInventory($items);
        $this->logOrder($orderId);
        
        return $finalTotal;
    }
    
    // é‡å¤çš„VIPæŠ˜æ‰£é€»è¾‘ï¼Œä½†æ¯”ä¾‹ä¸åŒ
    public function calculateVipDiscount($amount, $userType) 
    {
        if ($userType == 'VIP') {
            return $amount * 0.85; // 15%æŠ˜æ‰£ - ä¸ä¸Šé¢ä¸ä¸€è‡´ï¼
        }
        return $amount;
    }
    
    // å…¶ä»–æ–¹æ³•...
    public function processPayment($method, $amount) { /* ... */ }
    public function sendNotification($userId) { /* ... */ }
    public function updateInventory($items) { /* ... */ }
    public function logOrder($orderId) { /* ... */ }
}
```

```php
<?php
// demo_code/GoodCode.php - é‡æ„åçš„è‰¯å¥½ä»£ç 
class OrderProcessor
{
    private const DEFAULT_SHIPPING_COST = 15.99;
    private const TAX_RATE = 0.085;
    
    private OrderValidator $validator;
    private PriceCalculator $priceCalculator;
    private PaymentProcessor $paymentProcessor;
    
    public function __construct(
        OrderValidator $validator,
        PriceCalculator $priceCalculator, 
        PaymentProcessor $paymentProcessor
    ) {
        $this->validator = $validator;
        $this->priceCalculator = $priceCalculator;
        $this->paymentProcessor = $paymentProcessor;
    }
    
    public function processOrder(OrderRequest $orderRequest): OrderResult
    {
        $this->validator->validate($orderRequest);
        
        $itemsTotal = $this->priceCalculator->calculateItemsTotal($orderRequest->getItems());
        $discountedTotal = $this->priceCalculator->applyDiscount(
            $itemsTotal, 
            $orderRequest->getUserType()
        );
        
        $finalTotal = $this->calculateFinalTotal($discountedTotal);
        
        $order = $this->createOrder($orderRequest, $finalTotal);
        
        $this->processPayment($orderRequest->getPaymentMethod(), $finalTotal);
        $this->sendNotification($orderRequest->getUserId());
        $this->updateInventory($orderRequest->getItems());
        
        return new OrderResult($order);
    }
    
    private function calculateFinalTotal(float $itemsTotal): float
    {
        $shipping = self::DEFAULT_SHIPPING_COST;
        $tax = $itemsTotal * self::TAX_RATE;
        
        return $itemsTotal + $shipping + $tax;
    }
}

class PriceCalculator  
{
    private const VIP_DISCOUNT_RATE = 0.20; // ç»Ÿä¸€çš„VIPæŠ˜æ‰£ç‡
    
    public function applyDiscount(float $amount, string $userType): float
    {
        if ($userType === 'VIP') {
            return $amount * (1 - self::VIP_DISCOUNT_RATE);
        }
        
        return $amount;
    }
}
```

## 2. ä¼ ç»Ÿå·¥å…· vs AIå·¥å…·å¯¹æ¯”

### 2.1 PHPStan åˆ†æ

```bash
# è¿è¡ŒPHPStan
./vendor/bin/phpstan analyse demo_code/BadCode.php --level=8

# è¾“å‡ºç¤ºä¾‹ï¼š
# ------ -----------------------------------------------------------------------
#  Line   demo_code/BadCode.php
# ------ -----------------------------------------------------------------------
#  8      Method OrderProcessor::processOrder() has parameter $orderId with no typehint specified.
#  8      Method OrderProcessor::processOrder() has parameter $userId with no typehint specified.
#  ...
# ------ -----------------------------------------------------------------------
```

### 2.2 Psalm åˆ†æ

```bash
# è¿è¡ŒPsalm
./vendor/bin/psalm demo_code/BadCode.php

# è¾“å‡ºç¤ºä¾‹ï¼š
# ERROR: MixedAssignment - demo_code/BadCode.php:15:13 - Unable to determine the type
# ERROR: MixedOperand - demo_code/BadCode.php:20:25 - Left operand cannot be mixed
```

### 2.3 AIå·¥å…·åˆ†æå¯¹æ¯”

**CodeRabbitåˆ†æç»“æœç¤ºä¾‹ï¼š**
```markdown
## ğŸ¤– AIä»£ç å®¡æŸ¥æŠ¥å‘Š

### ä¸»è¦é—®é¢˜ï¼š

1. **é•¿æ–¹æ³•å¼‚å‘³** (ç½®ä¿¡åº¦: 95%)
   - `processOrder`æ–¹æ³•åŒ…å«67è¡Œä»£ç ï¼Œè¿åå•ä¸€èŒè´£åŸåˆ™
   - å»ºè®®ï¼šæ‹†åˆ†ä¸ºå¤šä¸ªä¸“èŒæ–¹æ³•

2. **ä¸šåŠ¡é€»è¾‘ä¸ä¸€è‡´** (ç½®ä¿¡åº¦: 88%) 
   - VIPæŠ˜æ‰£åœ¨ä¸¤ä¸ªåœ°æ–¹åˆ†åˆ«æ˜¯20%å’Œ15%
   - å»ºè®®ï¼šç»Ÿä¸€æŠ˜æ‰£è®¡ç®—é€»è¾‘

3. **å®‰å…¨æ¼æ´** (ç½®ä¿¡åº¦: 99%)
   - SQLæ³¨å…¥é£é™©åœ¨ç¬¬47è¡Œ
   - å»ºè®®ï¼šä½¿ç”¨é¢„å¤„ç†è¯­å¥

4. **ä»£ç é‡å¤** (ç½®ä¿¡åº¦: 76%)
   - ä»·æ ¼è®¡ç®—é€»è¾‘åœ¨å¤šå¤„é‡å¤
   - å»ºè®®ï¼šæå–å…¬å…±æ–¹æ³•
```

## 3. å¼€æºAIå·¥å…·å®æˆ˜

### 3.1 CodeRabbité›†æˆæ¼”ç¤º

```bash
# 1. åœ¨GitHubä»“åº“å®‰è£…CodeRabbit App
# 2. åˆ›å»ºé…ç½®æ–‡ä»¶
cat > .coderabbit.yaml << EOF
language: "php"
rules:
  include:
    - "src/**/*.php"
  exclude:
    - "vendor/**"
    - "tests/**"
    
reviews:
  high_level_summary: true
  poem: false
  review_status: true
  
  auto_review:
    enabled: true
    drafts: false
    
paths:
  - "src/**/*.php"
  - "app/**/*.php"
EOF

# 3. åˆ›å»ºPRè§¦å‘è‡ªåŠ¨å®¡æŸ¥
git add .
git commit -m "æ·»åŠ æœ‰é—®é¢˜çš„ä»£ç ç”¨äºæ¼”ç¤º"
git push origin feature/demo-bad-code
```

### 3.2 Codium AI PR-Agentä½¿ç”¨

```bash
# å®‰è£…å’Œé…ç½®PR-Agent
git clone https://github.com/Codium-ai/pr-agent.git
cd pr-agent

# åˆ›å»ºé…ç½®æ–‡ä»¶
cat > .pr_agent.toml << EOF
[github]
user_token = "your_github_token"

[pr_reviewer]
require_score_review = false
require_tests_review = true
require_security_review = true

[pr_description]
enable_semantic_files_types = true
use_bullet_points = true
EOF

# è¿è¡ŒPRåˆ†æ
python -m pr_agent.cli --pr_url="https://github.com/your-repo/pull/123"
```

### 3.3 è‡ªå®šä¹‰PHPMNDé­”æ•°æ£€æµ‹

```bash
# è¿è¡Œé­”æ•°æ£€æµ‹
./vendor/bin/phpmnd demo_code/BadCode.php --exclude=tests

# è¾“å‡ºï¼š
# demo_code/BadCode.php:25 - Magic number: 1.1
# demo_code/BadCode.php:32 - Magic number: 0.8  
# demo_code/BadCode.php:36 - Magic number: 15.99
# demo_code/BadCode.php:37 - Magic number: 0.085
```

## 4. è‡ªå»ºAIæ£€æµ‹ç³»ç»Ÿæ¼”ç¤º

### 4.1 PHP ASTåˆ†ææ¼”ç¤º

```php
<?php
// tools/ast_demo.php
require_once __DIR__ . '/../vendor/autoload.php';

use PhpParser\Error;
use PhpParser\NodeDumper;
use PhpParser\ParserFactory;
use PhpParser\NodeTraverser;
use PhpParser\NodeVisitorAbstract;
use PhpParser\Node;

$code = file_get_contents(__DIR__ . '/../demo_code/BadCode.php');

$parser = (new ParserFactory)->create(ParserFactory::PREFER_PHP7);
$traverser = new NodeTraverser();

// æ·»åŠ è®¿é—®è€…æ¥åˆ†æä»£ç 
$visitor = new class extends NodeVisitorAbstract {
    public $metrics = [];
    public $currentMethod = null;
    
    public function enterNode(Node $node) {
        if ($node instanceof Node\Stmt\ClassMethod) {
            $this->currentMethod = $node->name->toString();
            $this->metrics[$this->currentMethod] = [
                'lines' => $node->getEndLine() - $node->getStartLine() + 1,
                'parameters' => count($node->params),
                'complexity' => 1 // åŸºç¡€å¤æ‚åº¦
            ];
        }
        
        // è®¡ç®—åœˆå¤æ‚åº¦
        if ($this->currentMethod && (
            $node instanceof Node\Stmt\If_ ||
            $node instanceof Node\Stmt\While_ ||
            $node instanceof Node\Stmt\For_
        )) {
            $this->metrics[$this->currentMethod]['complexity']++;
        }
    }
};

$traverser->addVisitor($visitor);

try {
    $ast = $parser->parse($code);
    $traverser->traverse($ast);
    
    echo "=== ä»£ç åº¦é‡åˆ†æ ===\n";
    foreach ($visitor->metrics as $method => $metrics) {
        echo "æ–¹æ³•: {$method}\n";
        echo "  ä»£ç è¡Œæ•°: {$metrics['lines']}\n";
        echo "  å‚æ•°æ•°é‡: {$metrics['parameters']}\n"; 
        echo "  åœˆå¤æ‚åº¦: {$metrics['complexity']}\n";
        echo "\n";
    }
} catch (Error $error) {
    echo "è§£æé”™è¯¯: {$error->getMessage()}\n";
}
```

### 4.2 æœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒæ¼”ç¤º

```python
# tools/train_demo.py
import json
import numpy as np
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import classification_report

# æ¨¡æ‹Ÿè®­ç»ƒæ•°æ®
training_data = [
    {
        'features': [67, 8, 15, 3, 1, 0.6, 0.8],  # é•¿æ–¹æ³•ï¼Œå¤šå‚æ•°ï¼Œé«˜å¤æ‚åº¦
        'label': 1,  # æœ‰å¼‚å‘³
        'description': 'OrderProcessor::processOrder - é•¿æ–¹æ³•'
    },
    {
        'features': [12, 2, 3, 0, 0, 1.0, 0.2],  # çŸ­æ–¹æ³•ï¼Œå°‘å‚æ•°ï¼Œä½å¤æ‚åº¦  
        'label': 0,  # æ— å¼‚å‘³
        'description': 'UserValidator::validateEmail - ç®€æ´æ–¹æ³•'
    },
    # ... æ›´å¤šè®­ç»ƒæ ·æœ¬
]

# åˆ›å»ºæ›´å¤šæ¨¡æ‹Ÿæ•°æ®
def generate_training_data(n_samples=1000):
    """ç”Ÿæˆæ¨¡æ‹Ÿè®­ç»ƒæ•°æ®"""
    X, y = [], []
    
    for i in range(n_samples):
        # éšæœºç”Ÿæˆç‰¹å¾
        lines = np.random.randint(5, 200)
        params = np.random.randint(0, 15)
        complexity = np.random.randint(1, 20)
        nesting = np.random.randint(0, 8)
        security_issues = np.random.randint(0, 5)
        
        # ç®€å•çš„æ ‡ç­¾ç”Ÿæˆè§„åˆ™
        label = 0
        if lines > 50 or params > 6 or complexity > 10 or security_issues > 0:
            label = 1
            
        features = [lines, params, complexity, nesting, security_issues, 
                   np.random.random(), np.random.random()]
        
        X.append(features)
        y.append(label)
    
    return np.array(X), np.array(y)

print("ğŸ¤– å¼€å§‹è®­ç»ƒAIæ¨¡å‹...")

# ç”Ÿæˆè®­ç»ƒæ•°æ®
X, y = generate_training_data(1000)

# åˆ†å‰²æ•°æ®
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

# è®­ç»ƒæ¨¡å‹
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train, y_train)

# è¯„ä¼°æ¨¡å‹
train_score = model.score(X_train, y_train)
test_score = model.score(X_test, y_test)

print(f"è®­ç»ƒå‡†ç¡®ç‡: {train_score:.3f}")
print(f"æµ‹è¯•å‡†ç¡®ç‡: {test_score:.3f}")

# é¢„æµ‹æ–°æ ·æœ¬
new_sample = [[67, 8, 15, 3, 1, 0.6, 0.8]]  # BadCode.phpçš„ç‰¹å¾
prediction = model.predict(new_sample)[0]
probability = model.predict_proba(new_sample)[0]

print(f"\næ–°æ ·æœ¬é¢„æµ‹:")
print(f"é¢„æµ‹ç»“æœ: {'æœ‰å¼‚å‘³' if prediction == 1 else 'æ— å¼‚å‘³'}")
print(f"ç½®ä¿¡åº¦: {max(probability):.3f}")

# ç‰¹å¾é‡è¦æ€§
feature_names = ['ä»£ç è¡Œæ•°', 'å‚æ•°æ•°é‡', 'åœˆå¤æ‚åº¦', 'åµŒå¥—æ·±åº¦', 'å®‰å…¨é—®é¢˜', 'è®¾è®¡æŒ‡æ ‡1', 'è®¾è®¡æŒ‡æ ‡2']
importances = model.feature_importances_

print(f"\nç‰¹å¾é‡è¦æ€§:")
for name, importance in zip(feature_names, importances):
    print(f"{name}: {importance:.3f}")
```

### 4.3 ä¸šåŠ¡é€»è¾‘ä¸€è‡´æ€§æ£€æµ‹æ¼”ç¤º

```python
# tools/business_consistency_demo.py
import re
from typing import List, Dict

class BusinessConsistencyChecker:
    def __init__(self):
        self.discount_patterns = []
        self.price_calculations = []
        
    def analyze_php_files(self, file_paths: List[str]) -> Dict:
        """åˆ†æPHPæ–‡ä»¶ä¸­çš„ä¸šåŠ¡é€»è¾‘ä¸€è‡´æ€§"""
        issues = []
        
        for file_path in file_paths:
            with open(file_path, 'r', encoding='utf-8') as f:
                content = f.read()
                
            # æ£€æµ‹æŠ˜æ‰£è®¡ç®—é€»è¾‘
            discount_issues = self._check_discount_consistency(content, file_path)
            issues.extend(discount_issues)
            
        return {
            'total_issues': len(issues),
            'issues': issues
        }
    
    def _check_discount_consistency(self, content: str, file_path: str) -> List[Dict]:
        """æ£€æŸ¥æŠ˜æ‰£è®¡ç®—çš„ä¸€è‡´æ€§"""
        issues = []
        
        # æŸ¥æ‰¾VIPæŠ˜æ‰£æ¨¡å¼
        vip_patterns = re.findall(r'VIP.*?(\d+\.?\d*)', content, re.IGNORECASE)
        discount_rates = []
        
        for match in vip_patterns:
            try:
                rate = float(match)
                if 0 < rate < 1:  # å°æ•°å½¢å¼çš„æŠ˜æ‰£
                    discount_rates.append(rate)
                elif rate > 1:  # ç™¾åˆ†æ¯”å½¢å¼
                    discount_rates.append(rate / 100)
            except ValueError:
                continue
                
        # æ£€æŸ¥ä¸€è‡´æ€§
        if len(set(discount_rates)) > 1:
            issues.append({
                'type': 'discount_inconsistency',
                'file': file_path,
                'description': f'VIPæŠ˜æ‰£ç‡ä¸ä¸€è‡´: {discount_rates}',
                'severity': 'medium',
                'rates_found': discount_rates
            })
            
        return issues

# æ¼”ç¤ºä½¿ç”¨
print("ğŸ” ä¸šåŠ¡é€»è¾‘ä¸€è‡´æ€§æ£€æµ‹æ¼”ç¤º...")

checker = BusinessConsistencyChecker()
result = checker.analyze_php_files(['demo_code/BadCode.php'])

print(f"å‘ç° {result['total_issues']} ä¸ªä¸šåŠ¡é€»è¾‘é—®é¢˜:")
for issue in result['issues']:
    print(f"- {issue['description']}")
    print(f"  æ–‡ä»¶: {issue['file']}")
    print(f"  ä¸¥é‡ç¨‹åº¦: {issue['severity']}")
```

## 5. CI/CDé›†æˆæ¼”ç¤º

### 5.1 GitHub Actionsæ¼”ç¤º

```yaml
# .github/workflows/ai-code-review-demo.yml
name: AIä»£ç å¼‚å‘³æ£€æµ‹æ¼”ç¤º

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  ai-code-analysis:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
      
    - name: è®¾ç½®PHPç¯å¢ƒ
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.1'
        extensions: mbstring, xml, ctype, json
        
    - name: è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: å®‰è£…PHPä¾èµ–
      run: composer install --no-dev --prefer-dist
      
    - name: å®‰è£…Pythonä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install scikit-learn pandas numpy
        
    - name: è¿è¡Œä¼ ç»Ÿå·¥å…·åˆ†æ
      run: |
        echo "=== PHPStan åˆ†æ ===" > analysis_report.txt
        ./vendor/bin/phpstan analyse demo_code/ --level=8 --no-progress --error-format=table >> analysis_report.txt || true
        
        echo "=== PHPMND é­”æ•°æ£€æµ‹ ===" >> analysis_report.txt  
        ./vendor/bin/phpmnd demo_code/ --exclude=tests >> analysis_report.txt || true
        
    - name: è¿è¡ŒAIå¼‚å‘³æ£€æµ‹
      run: |
        echo "=== AIä»£ç å¼‚å‘³æ£€æµ‹ ===" >> analysis_report.txt
        python tools/ast_demo.php >> analysis_report.txt
        python tools/train_demo.py >> analysis_report.txt
        python tools/business_consistency_demo.py >> analysis_report.txt
        
    - name: ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
      run: |
        echo "=== å·¥å…·å¯¹æ¯”æ€»ç»“ ===" >> analysis_report.txt
        echo "ä¼ ç»Ÿå·¥å…·å‘ç°çš„é—®é¢˜ç±»å‹ï¼šè¯­æ³•é”™è¯¯ã€ç±»å‹é”™è¯¯ã€ä»£ç é£æ ¼" >> analysis_report.txt
        echo "AIå·¥å…·å‘ç°çš„é—®é¢˜ç±»å‹ï¼šä¸šåŠ¡é€»è¾‘ä¸ä¸€è‡´ã€å¤æ‚è®¾è®¡å¼‚å‘³ã€ä¸Šä¸‹æ–‡ç›¸å…³é—®é¢˜" >> analysis_report.txt
        
    - name: ä¸Šä¼ åˆ†ææŠ¥å‘Š
      uses: actions/upload-artifact@v3
      with:
        name: code-analysis-report
        path: analysis_report.txt
        
    - name: è¯„è®ºPRç»“æœ  
      if: github.event_name == 'pull_request'
      uses: actions/github-script@v6
      with:
        script: |
          const fs = require('fs');
          const report = fs.readFileSync('analysis_report.txt', 'utf8');
          
          const comment = `## ğŸ¤– AIä»£ç åˆ†ææŠ¥å‘Š
          
          \`\`\`
          ${report}
          \`\`\`
          
          **è¯´æ˜**: è¿™æ˜¯AIé©±åŠ¨çš„ä»£ç å¼‚å‘³æ£€æµ‹æ¼”ç¤ºç»“æœ
          `;
          
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: comment
          });
```

### 5.2 æœ¬åœ°å¼€å‘å·¥å…·é›†æˆ

```bash
#!/bin/bash
# tools/local_analysis.sh - æœ¬åœ°åˆ†æè„šæœ¬

echo "ğŸš€ AIé©±åŠ¨çš„PHPä»£ç å¼‚å‘³æ£€æµ‹æ¼”ç¤º"
echo "=================================="

# åˆ›å»ºç»“æœç›®å½•
mkdir -p reports

# 1. ä¼ ç»Ÿå·¥å…·åˆ†æ
echo "ğŸ“Š è¿è¡Œä¼ ç»Ÿé™æ€åˆ†æå·¥å…·..."

echo "PHPStanåˆ†æ:" > reports/traditional_tools.txt
./vendor/bin/phpstan analyse demo_code/ --level=8 >> reports/traditional_tools.txt 2>&1

echo -e "\nPHPMDåˆ†æ:" >> reports/traditional_tools.txt
./vendor/bin/phpmd demo_code/ text cleancode,codesize >> reports/traditional_tools.txt 2>&1

echo -e "\nPHPMNDé­”æ•°æ£€æµ‹:" >> reports/traditional_tools.txt  
./vendor/bin/phpmnd demo_code/ >> reports/traditional_tools.txt 2>&1

# 2. AIå·¥å…·åˆ†æ
echo "ğŸ¤– è¿è¡ŒAIå¼‚å‘³æ£€æµ‹..."

python tools/ast_demo.py > reports/ai_analysis.txt
python tools/train_demo.py >> reports/ai_analysis.txt
python tools/business_consistency_demo.py >> reports/ai_analysis.txt

# 3. ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š
echo "ğŸ“‹ ç”Ÿæˆå¯¹æ¯”æŠ¥å‘Š..."

cat > reports/comparison_report.md << EOF
# AI vs ä¼ ç»Ÿå·¥å…·æ£€æµ‹ç»“æœå¯¹æ¯”

## ä¼ ç»Ÿå·¥å…·æ£€æµ‹ç»“æœ

### PHPStan (ç±»å‹å’Œè¯­æ³•æ£€æŸ¥)
- å‘ç°äº†æœªå®šä¹‰ç±»å‹çš„å‚æ•°
- æ£€æµ‹åˆ°å¯èƒ½çš„ç±»å‹é”™è¯¯
- æ— æ³•ç†è§£ä¸šåŠ¡é€»è¾‘é—®é¢˜

### PHPMD (å¤æ‚åº¦æ£€æµ‹)  
- æ£€æµ‹åˆ°æ–¹æ³•è¿‡é•¿
- å‘ç°åœˆå¤æ‚åº¦è¿‡é«˜
- æ— æ³•å‘ç°ä¸šåŠ¡ä¸ä¸€è‡´é—®é¢˜

### PHPMND (é­”æ•°æ£€æµ‹)
- å‘ç°ç¡¬ç¼–ç çš„æ•°å­—
- ç¼ºä¹ä¸šåŠ¡è¯­ä¹‰ç†è§£

## AIå·¥å…·æ£€æµ‹ç»“æœ

### AST + æœºå™¨å­¦ä¹ åˆ†æ
- âœ… æ£€æµ‹åˆ°é•¿æ–¹æ³•å¼‚å‘³ (ç½®ä¿¡åº¦: 95%)
- âœ… å‘ç°å‚æ•°åˆ—è¡¨è¿‡é•¿ (ç½®ä¿¡åº¦: 88%)
- âœ… è¯†åˆ«æ·±å±‚åµŒå¥—ç»“æ„ (ç½®ä¿¡åº¦: 76%)

### ä¸šåŠ¡é€»è¾‘ä¸€è‡´æ€§æ£€æµ‹
- âœ… å‘ç°VIPæŠ˜æ‰£ç‡ä¸ä¸€è‡´ (20% vs 15%)
- âœ… æ£€æµ‹åˆ°é‡å¤çš„ä»·æ ¼è®¡ç®—é€»è¾‘
- âœ… è¯†åˆ«å®‰å…¨æ¼æ´æ¨¡å¼

## æ€»ç»“

| æ£€æµ‹èƒ½åŠ› | ä¼ ç»Ÿå·¥å…· | AIå·¥å…· |
|---------|---------|--------|
| è¯­æ³•é”™è¯¯ | âœ… ä¼˜ç§€ | âœ… è‰¯å¥½ |
| ç±»å‹æ£€æŸ¥ | âœ… ä¼˜ç§€ | âœ… è‰¯å¥½ |
| ä»£ç é£æ ¼ | âœ… ä¼˜ç§€ | âœ… è‰¯å¥½ |
| å¤æ‚åº¦æ£€æµ‹ | âœ… è‰¯å¥½ | âœ… ä¼˜ç§€ |
| ä¸šåŠ¡é€»è¾‘ä¸€è‡´æ€§ | âŒ æ— æ³•æ£€æµ‹ | âœ… ä¼˜ç§€ |
| ä¸Šä¸‹æ–‡ç†è§£ | âŒ æ— æ³•æ£€æµ‹ | âœ… ä¼˜ç§€ |
| å®‰å…¨æ¼æ´ | âš ï¸ åŸºç¡€æ£€æµ‹ | âœ… æ™ºèƒ½æ£€æµ‹ |

EOF

echo "âœ… åˆ†æå®Œæˆï¼æŸ¥çœ‹æŠ¥å‘Šï¼š"
echo "- ä¼ ç»Ÿå·¥å…·ç»“æœ: reports/traditional_tools.txt"
echo "- AIå·¥å…·ç»“æœ: reports/ai_analysis.txt"  
echo "- å¯¹æ¯”æŠ¥å‘Š: reports/comparison_report.md"

# å¯é€‰ï¼šåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æŠ¥å‘Š
if command -v open >/dev/null 2>&1; then
    open reports/comparison_report.md
elif command -v xdg-open >/dev/null 2>&1; then
    xdg-open reports/comparison_report.md
fi
```

## 6. æ•ˆæœå¯¹æ¯”ä¸è®¨è®º

### 6.1 æ£€æµ‹æ•ˆæœæ•°æ®å¯¹æ¯”

```python
# tools/effectiveness_comparison.py
import matplotlib.pyplot as plt
import numpy as np

# æ¨¡æ‹ŸçœŸå®é¡¹ç›®æ£€æµ‹æ•°æ®
tools_comparison = {
    'PHPStan': {
        'issues_found': 45,
        'false_positives': 12,
        'business_logic_issues': 0,
        'time_seconds': 15
    },
    'Psalm': {
        'issues_found': 38,
        'false_positives': 11,
        'business_logic_issues': 0,
        'time_seconds': 12
    },
    'PHPMD': {
        'issues_found': 67,
        'false_positives': 23,
        'business_logic_issues': 0,
        'time_seconds': 8
    },
    'AI Solution': {
        'issues_found': 89,
        'false_positives': 8,
        'business_logic_issues': 15,
        'time_seconds': 45
    }
}

# åˆ›å»ºå¯¹æ¯”å›¾è¡¨
fig, ((ax1, ax2), (ax3, ax4)) = plt.subplots(2, 2, figsize=(12, 10))

tools = list(tools_comparison.keys())
colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4']

# 1. å‘ç°é—®é¢˜æ•°é‡å¯¹æ¯”
issues = [data['issues_found'] for data in tools_comparison.values()]
ax1.bar(tools, issues, color=colors)
ax1.set_title('é—®é¢˜å‘ç°æ•°é‡å¯¹æ¯”')
ax1.set_ylabel('é—®é¢˜æ•°é‡')

# 2. è¯¯æŠ¥ç‡å¯¹æ¯”  
false_positive_rates = [data['false_positives']/data['issues_found']*100 
                       for data in tools_comparison.values()]
ax2.bar(tools, false_positive_rates, color=colors)
ax2.set_title('è¯¯æŠ¥ç‡å¯¹æ¯” (%)')
ax2.set_ylabel('è¯¯æŠ¥ç‡ (%)')

# 3. ä¸šåŠ¡é€»è¾‘é—®é¢˜æ£€æµ‹
business_issues = [data['business_logic_issues'] for data in tools_comparison.values()]
ax3.bar(tools, business_issues, color=colors)
ax3.set_title('ä¸šåŠ¡é€»è¾‘é—®é¢˜æ£€æµ‹')
ax3.set_ylabel('é—®é¢˜æ•°é‡')

# 4. åˆ†ææ—¶é—´å¯¹æ¯”
times = [data['time_seconds'] for data in tools_comparison.values()]
ax4.bar(tools, times, color=colors)
ax4.set_title('åˆ†ææ—¶é—´å¯¹æ¯” (ç§’)')
ax4.set_ylabel('æ—¶é—´ (ç§’)')

plt.tight_layout()
plt.savefig('reports/tools_comparison.png', dpi=300, bbox_inches='tight')
plt.show()

print("ğŸ“Š æ•ˆæœå¯¹æ¯”å›¾è¡¨å·²ä¿å­˜åˆ° reports/tools_comparison.png")
```

### 6.2 ç°åœºæ¼”ç¤ºé—®ç­”ç¯èŠ‚

**Q1: AIå·¥å…·çš„è¯¯æŠ¥ç‡çœŸçš„æ¯”ä¼ ç»Ÿå·¥å…·ä½å—ï¼Ÿ**

A: åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¸­ç¡®å®å¦‚æ­¤ï¼Œä¸»è¦åŸå› æ˜¯ï¼š
- AIèƒ½ç†è§£ä¸Šä¸‹æ–‡ï¼Œé¿å…ç®€å•çš„æ¨¡å¼åŒ¹é…è¯¯æŠ¥
- é€šè¿‡é›†æˆå­¦ä¹ æé«˜å‡†ç¡®æ€§
- å¯ä»¥æ ¹æ®é¡¹ç›®ç‰¹ç‚¹æŒç»­ä¼˜åŒ–

**Q2: AIå·¥å…·éƒ¨ç½²å¤æ‚åº¦å¦‚ä½•ï¼Ÿ**

A: åˆ†å‡ ä¸ªå±‚æ¬¡ï¼š
- ç°æˆæœåŠ¡ï¼ˆå¦‚CodeRabbitï¼‰ï¼šå‡ åˆ†é’Ÿå³å¯é›†æˆ
- å¼€æºæ–¹æ¡ˆï¼šéœ€è¦1-2å¤©é…ç½®
- è‡ªå»ºç³»ç»Ÿï¼šéœ€è¦1-2å‘¨å¼€å‘

**Q3: è®¡ç®—èµ„æºæ¶ˆè€—å¤§å—ï¼Ÿ**

A: ç›¸æ¯”æ·±åº¦å­¦ä¹ æ–¹æ¡ˆå·²ç»å¾ˆè½»é‡ï¼š
- å†…å­˜éœ€æ±‚ï¼š2-4GB
- CPUä½¿ç”¨ï¼šåˆ†æ1000ä¸ªæ–‡ä»¶çº¦éœ€5-10åˆ†é’Ÿ
- å­˜å‚¨ï¼šæ¨¡å‹æ–‡ä»¶é€šå¸¸<100MB

**Q4: å¦‚ä½•å¤„ç†å›¢é˜Ÿæ¥å—åº¦é—®é¢˜ï¼Ÿ**

A: å»ºè®®æ¸è¿›å¼å¼•å…¥ï¼š
- ç¬¬ä¸€é˜¶æ®µï¼šåªä½œä¸ºè¾…åŠ©å‚è€ƒ
- ç¬¬äºŒé˜¶æ®µï¼šåŠ å…¥code reviewæµç¨‹
- ç¬¬ä¸‰é˜¶æ®µï¼šè®¾ç½®è´¨é‡é—¨ç¦

**Q5: å¼€æºå·¥å…·çš„å¯é æ€§å¦‚ä½•ä¿è¯ï¼Ÿ**

A: å¤šæ–¹é¢è€ƒè™‘ï¼š
- é€‰æ‹©staræ•°é«˜ã€ç¤¾åŒºæ´»è·ƒçš„é¡¹ç›®
- å…³æ³¨ä»£ç è´¨é‡å’Œæµ‹è¯•è¦†ç›–ç‡
- æœ‰å¤§å…¬å¸èƒŒä¹¦ï¼ˆå¦‚Microsoftçš„CodeRabbitï¼‰
- å¯ä»¥forkè‡ªå·±ç»´æŠ¤

---

## ğŸ¯ æ¼”ç¤ºæ€»ç»“

### æ ¸å¿ƒæ”¶è·

1. **AIå·¥å…·ç¡®å®èƒ½å‘ç°ä¼ ç»Ÿå·¥å…·é—æ¼çš„é—®é¢˜**
   - ä¸šåŠ¡é€»è¾‘ä¸€è‡´æ€§
   - å¤æ‚çš„è®¾è®¡å¼‚å‘³
   - ä¸Šä¸‹æ–‡ç›¸å…³çš„å®‰å…¨é—®é¢˜

2. **å¼€æºç”Ÿæ€å·²ç»ç›¸å½“æˆç†Ÿ**
   - å¤šä¸ªå¯é€‰æ–¹æ¡ˆ
   - é›†æˆç›¸å¯¹ç®€å•
   - ç¤¾åŒºæ”¯æŒè‰¯å¥½

3. **ROIè¾ƒé«˜**
   - å¼€å‘æ•ˆç‡æå‡æ˜æ˜¾
   - ä»£ç è´¨é‡æ”¹å–„æ˜¾è‘—
   - ç»´æŠ¤æˆæœ¬å¯æ§

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

1. **é€‰æ‹©ä¸€ä¸ªå¼€æºå·¥å…·è¯•ç‚¹**ï¼ˆæ¨èCodeRabbitï¼‰
2. **åœ¨éå…³é”®é¡¹ç›®ä¸ŠéªŒè¯æ•ˆæœ**
3. **æ”¶é›†å›¢é˜Ÿåé¦ˆå¹¶ä¼˜åŒ–é…ç½®**
4. **é€æ­¥æ¨å¹¿åˆ°æ ¸å¿ƒé¡¹ç›®**
5. **è€ƒè™‘è‡ªå»ºç³»ç»Ÿæ»¡è¶³ç‰¹æ®Šéœ€æ±‚**

---

**æ¼”ç¤ºèµ„æºä¸‹è½½ï¼š**
- GitHubä»“åº“ï¼šhttps://github.com/your-org/ai-php-smell-demo
- æ¼”ç¤ºè§†é¢‘ï¼šé“¾æ¥åœ°å€
- é…ç½®æ–‡ä»¶æ¨¡æ¿ï¼štools/templates/ 